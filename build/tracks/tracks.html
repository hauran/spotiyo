<polymer-element name="yo-tracks">
<template>
	<style>:host .overlay-title .back-angle {
  margin-top: 6px;
}
:host .overlay-title h1 {
  font-size: 1.3em;
  position: relative;
  top: 10px;
  height: 31px;
}
:host .container,
:host .overlay-title {
  display: none;
}
:host .container.active,
:host .overlay-title.active {
  display: inline;
}
:host .container {
  background: #34495e;
  z-index: 1;
}
:host .container .tracks {
  margin-bottom: 70px;
  padding-bottom: 71px;
}
</style>
	<div class="overlay-title {{ {active:active, noHeight:noHeight} | tokenList}}">
		<i class="fa fa-angle-left back-angle" on-click="{{close}}"></i><h1>{{title}}</h1>
	</div>
	<div id="container" class="overlay container {{ {active:active, noHeight:noHeight} | tokenList}}">
		<div class="content">
			<div class="loading {{ {hide:!loading} | tokenList}}">loading...</div>
			<!-- <iframe id="ytplayer" type="text/html" width="100%" height="100%" src="{{url}}" frameborder="0" allowfullscreen></iframe> -->
			<div class="tracks">
				<template repeat="{{item, i in items }}">
				 	<yo-track number="{{i}}" artist="{{item.track.artists[0].name}}" name="{{item.track.name}}" imgsrc="{{item.track.album.images[2].url}}" uri="{{item.track.uri}}"></yo-track>
				</template>
			</div>
		</div>
	</div>
</template>

<script built="/Users/rmai/gitrepo/yoplay/src/elements/tracks/tracks.coffee">(function e(t, n, r) {
    function s(o, u) {
        if (!n[o]) {
            if (!t[o]) {
                var a = typeof require == "function" && require;
                if (!u && a) return a(o, !0);
                if (i) return i(o, !0);
                throw new Error("Cannot find module '" + o + "'");
            }
            var f = n[o] = {
                exports: {}
            };
            t[o][0].call(f.exports, function(e) {
                var n = t[o][1][e];
                return s(n ? n : e);
            }, f, f.exports, e, t, n, r);
        }
        return n[o].exports;
    }
    var i = typeof require == "function" && require;
    for (var o = 0; o < r.length; o++) s(r[o]);
    return s;
})({
    1: [ function(require, module, exports) {
        Polymer("yo-tracks", {
            ready: function() {
                this.playlist = document.querySelector("yo-playlist");
                this.player = document.querySelector("yo-player");
                this.title = "";
                this.active = false;
                this.loading = true;
                this.playing = null;
                return this.items = [];
            },
            play: function(uri) {
                var err;
                this.resetCurrentPlaying();
                setTimeout(function(_this) {
                    return function() {
                        document.querySelector("yo-player").shadowRoot.querySelector(".controls").classList.add("showControls");
                        return _this.playlist.playerShow = true;
                    };
                }(this), 350);
                console.log("playing: ", uri);
                try {
                    return Android.play(uri);
                } catch (_error) {
                    err = _error;
                    return console.log(err);
                }
            },
            resetCurrentPlaying: function() {
                var currentPlaying;
                currentPlaying = this.currentPlaying();
                if (currentPlaying) {
                    currentPlaying.shadowRoot.querySelector(".item-name").classList.remove("selected");
                    return currentPlaying.removeAttribute("playing");
                }
            },
            setPlaying: function() {
                var currentPlaying, err, first;
                currentPlaying = this.currentPlaying();
                if (!currentPlaying) {
                    try {
                        first = document.querySelector("yo-tracks").shadowRoot.querySelector("yo-track");
                        first.setAttribute("playing", "true");
                        first.shadowRoot.querySelector(".item-name").classList.add("selected");
                        return this.player.track(first.name, first.artist);
                    } catch (_error) {
                        err = _error;
                        return console.log(err);
                    }
                }
            },
            skipNext: function() {
                var currentTrack, next;
                currentTrack = this.currentPlaying();
                this.resetCurrentPlaying();
                next = document.querySelector("yo-tracks").shadowRoot.querySelectorAll("yo-track")[currentTrack.number + 1];
                next.setAttribute("playing", "true");
                next.shadowRoot.querySelector(".item-name").classList.add("selected");
                return this.player.track(next.name, next.artist);
            },
            currentPlaying: function() {
                var currentPlaying;
                currentPlaying = document.querySelector("yo-tracks").shadowRoot.querySelector("[playing=true]");
                return currentPlaying;
            },
            getTracks: function(id, href, uri) {
                this.player.pause();
                this.resetCurrentPlaying();
                this.items = [];
                this.loading = true;
                this.active = true;
                $(window).scrollTop(0);
                return $.get("/playlists/" + id + "/tracks", {
                    href: href
                }, function(_this) {
                    return function(res) {
                        _this.loading = false;
                        _this.items = res.items;
                        _this.play(uri);
                        return _this.player.play();
                    };
                }(this));
            },
            close: function() {
                this.active = false;
                return this.playlist.open();
            }
        });
    }, {} ]
}, {}, [ 1 ]);</script>
</polymer-element>
